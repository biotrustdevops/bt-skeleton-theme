{% liquid
  case section.settings.section_style
    when 'guidance'
      assign section_class = 'guidance-style'
      assign card_bg = 'bg-[#E3E7EB]'
      assign card_rounded = 'rounded-lg overflow-hidden'
    when 'subscription'
      assign section_class = 'subscription-style'
      assign card_bg = ''
      assign card_rounded = ''
    else
      assign section_class = 'default-style'
      assign card_bg = ''
      assign card_rounded = ''
  endcase
  
  assign desktop_cols = section.settings.columns_desktop
  assign mobile_cols = section.settings.columns_mobile
  assign text_align = section.settings.text_alignment
  
  case desktop_cols
    when '1'
      assign grid_desktop = 'lg:grid-cols-1'
    when '2'
      assign grid_desktop = 'lg:grid-cols-2'
    when '3'
      assign grid_desktop = 'lg:grid-cols-3'
    when '4'
      assign grid_desktop = 'lg:grid-cols-4'
    when '5'
      assign grid_desktop = 'lg:grid-cols-5'
    when '6'
      assign grid_desktop = 'lg:grid-cols-6'
    when '7'
      assign grid_desktop = 'lg:grid-cols-7'
    when '8'
      assign grid_desktop = 'lg:grid-cols-8'
    else
      assign grid_desktop = 'lg:grid-cols-3'
  endcase
  
  case mobile_cols
    when '1'
      assign grid_mobile = 'grid-cols-1'
    when '2'
      assign grid_mobile = 'grid-cols-2'
    else
      assign grid_mobile = 'grid-cols-2'
  endcase
  
  if section.settings.hide_gutters
    assign gap_class = 'gap-0'
  else
    assign gap_class = 'gap-5 lg:gap-6'
  endif
%}

<section class="feature-icon-columns-section {{ section_class }} relative overflow-hidden" 
         id="{{ section.id }}">
  
  {% comment %} Background images {% endcomment %}
  {% if section.settings.background_image != blank %}
    <div class="absolute inset-0 -z-10 hidden sm:block">
      {{ section.settings.background_image | image_url: width: 1920 | image_tag:
        loading: 'lazy',
        class: 'w-full h-full object-cover',
        widths: '960,1440,1920',
        sizes: '100vw'
      }}
    </div>
  {% endif %}
  
  {% if section.settings.background_mobile_image != blank %}
    <div class="absolute inset-0 -z-10 sm:hidden">
      {{ section.settings.background_mobile_image | image_url: width: 768 | image_tag:
        loading: 'lazy',
        class: 'w-full h-full object-cover',
        widths: '480,640,768',
        sizes: '100vw'
      }}
    </div>
  {% endif %}
  
  {% comment %} Decorative icons {% endcomment %}
  {% if section.settings.left_icon != blank %}
    <div class="absolute left-0 bottom-0 w-full max-w-[200px] lg:max-w-[200px] md:max-w-[150px] pointer-events-none hidden sm:block z-0">
      {{ section.settings.left_icon | image_url: width: 400 | image_tag:
        loading: 'lazy',
        class: 'w-full h-auto',
        widths: '200,300,400',
        sizes: '200px'
      }}
    </div>
  {% endif %}
  
  {% if section.settings.right_icon != blank %}
    <div class="absolute right-0 sm:right-[-50px] lg:right-0 top-[18%] w-full max-w-[260px] lg:max-w-[260px] md:max-w-[150px] sm:max-w-[130px] pointer-events-none z-0">
      {{ section.settings.right_icon | image_url: width: 520 | image_tag:
        loading: 'lazy',
        class: 'w-full h-auto',
        widths: '260,390,520',
        sizes: '260px'
      }}
    </div>
  {% endif %}
  
  <div class="md:container md:mx-auto px-0 md:px-5 py-10 lg:py-16 relative">
    {% comment %} Section header {% endcomment %}
    {% if section.settings.heading != blank %}
      <div class="text-center mb-10">
        <h2 class="text-[54px] sm:text-[74px] leading-[120%] font-normal mb-4"
            style="font-family: 'League Gothic', sans-serif; color: {{ section.settings.heading_color }};">
          {{ section.settings.heading }}
          {% if section.settings.section_style == 'subscription' and section.settings.heading_highlight != blank %}
            <span class="text-[#1AC83E]">{{ section.settings.heading_highlight }}</span>
          {% endif %}
        </h2>
        
        {% if section.settings.subheading != blank %}
          <div class="text-[#0D4F9A] text-lg sm:text-[22px] leading-[150%] max-w-[920px] mx-auto">
            {{ section.settings.subheading }}
          </div>
        {% endif %}
      </div>
    {% endif %}
    
    {% comment %} Grid of columns {% endcomment %}
    {% if section.blocks.size > 0 %}
      <div class="grid {{ grid_mobile }} sm:grid-cols-2 {{ grid_desktop }} {{ gap_class }} max-w-[1320px] mx-auto">
        {% for block in section.blocks %}
          <div class="{% if block.settings.hide_mobile %}hidden sm:block{% endif %} {% if text_align == 'center' %}text-center{% endif %}"
               {{ block.shopify_attributes }}>
            <div class="{{ card_bg }} {{ card_rounded }} h-full {% if section.settings.section_style == 'guidance' %}lg:h-[340px]{% endif %}">
              
              {% comment %} Image/Icon {% endcomment %}
              {% if block.settings.enable_image and block.settings.image != blank %}
                <div class="{% if section.settings.section_style == 'subscription' %}max-w-[110px] mx-auto{% endif %}">
                  {% if block.settings.image_link != blank %}
                    <a href="{{ block.settings.image_link }}" 
                       aria-label="{{ block.settings.image.alt | escape }}">
                  {% endif %}
                  
                  {% if section.settings.section_style == 'guidance' %}
                    {{ block.settings.image | image_url: width: 600 | image_tag:
                      loading: 'lazy',
                      class: 'w-full h-auto',
                      widths: '300,450,600',
                      sizes: '(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw'
                    }}
                  {% else %}
                    <div class="{% if section.settings.section_style == 'subscription' %}p-0{% else %}p-4{% endif %}">
                      {{ block.settings.image | image_url: width: 220 | image_tag:
                        loading: 'lazy',
                        class: 'w-full h-auto',
                        widths: '110,165,220',
                        sizes: '110px'
                      }}
                    </div>
                  {% endif %}
                  
                  {% if block.settings.image_link != blank %}
                    </a>
                  {% endif %}
                </div>
              {% endif %}
              
              {% comment %} Content {% endcomment %}
              <div class="{% if section.settings.section_style == 'guidance' %}p-5{% elsif section.settings.section_style == 'subscription' %}pt-6{% else %}p-4{% endif %}">
                {% if block.settings.title != blank %}
                  <h3 class="{% if section.settings.section_style == 'guidance' or section.settings.section_style == 'subscription' %}text-[#0A3B60] uppercase text-xl mb-2.5{% else %}text-2xl mb-4{% endif %}">
                    {% if block.settings.title_link != blank %}
                      <a href="{{ block.settings.title_link }}">{{ block.settings.title | escape }}</a>
                    {% else %}
                      {{ block.settings.title | escape }}
                    {% endif %}
                  </h3>
                {% endif %}
                
                {% if block.settings.text != blank %}
                  <div class="{% if section.settings.section_style == 'guidance' or section.settings.section_style == 'subscription' %}text-[#0A3B60] text-lg leading-[150%]{% else %}text-base{% endif %} [&_p]:mb-4 [&_p:last-child]:mb-0">
                    {{ block.settings.text }}
                  </div>
                {% endif %}
                
                {% if block.settings.button_label != blank and block.settings.button_link != blank %}
                  <div class="mt-5">
                    <a href="{{ block.settings.button_link }}" 
                       class="inline-block px-6 py-4 bg-gradient-to-b from-[#E7EBEF] to-[#F6F7F9] text-[#0B4F9A] font-bold rounded-lg hover:opacity-80 transition-opacity">
                      {{ block.settings.button_label | escape }}
                    </a>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    
    {% comment %} Section CTA button (subscription style only) {% endcomment %}
    {% if section.settings.section_style == 'subscription' and section.settings.section_button_text != blank and section.settings.section_button_link != blank %}
      <div class="text-center mt-10 lg:mt-[60px]">
        <a href="{{ section.settings.section_button_link }}" 
           class="inline-block px-10 py-5 bg-gradient-to-b from-[#E7EBEF] to-[#F6F7F9] text-[#0B4F9A] font-bold text-base rounded-lg hover:opacity-80 transition-opacity max-w-[250px]">
          {{ section.settings.section_button_text }}
        </a>
      </div>
    {% endif %}
  </div>
</section>

<style>
  @import url('https://fonts.googleapis.com/css2?family=League+Gothic&display=swap');
  
  #shopify-section-{{ section.id }} {
    margin-top: {{ section.settings.mobile_margin_top }}px;
    margin-bottom: {{ section.settings.mobile_margin_bottom }}px;
  }
  
  @media (min-width: 640px) {
    #shopify-section-{{ section.id }} {
      margin-top: {{ section.settings.desktop_margin_top }}px;
      margin-bottom: {{ section.settings.desktop_margin_bottom }}px;
    }
  }
</style>

{% schema %}
{
  "name": "Feature Icon Columns",
  "tag": "section",
  "class": "feature-icon-columns",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Feature Columns"
    },
    {
      "type": "text",
      "id": "heading_highlight",
      "label": "Heading Highlight",
      "info": "Text to highlight in green (subscription style only)"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#0A3B60"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_style",
      "label": "Section Style",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "guidance",
          "label": "Guidance (Cards)"
        },
        {
          "value": "subscription",
          "label": "Subscription (Icons)"
        }
      ],
      "default": "default"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Columns per Row (Desktop)",
      "default": "3",
      "options": [
        {"value": "1", "label": "1"},
        {"value": "2", "label": "2"},
        {"value": "3", "label": "3"},
        {"value": "4", "label": "4"},
        {"value": "5", "label": "5"},
        {"value": "6", "label": "6"},
        {"value": "7", "label": "7"},
        {"value": "8", "label": "8"}
      ]
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns per Row (Mobile)",
      "default": "2",
      "options": [
        {"value": "1", "label": "1"},
        {"value": "2", "label": "2"}
      ]
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "hide_gutters",
      "label": "Hide Gutters",
      "default": false,
      "info": "Remove spacing between columns"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image (Desktop)"
    },
    {
      "type": "image_picker",
      "id": "background_mobile_image",
      "label": "Background Image (Mobile)"
    },
    {
      "type": "image_picker",
      "id": "left_icon",
      "label": "Left Decorative Icon"
    },
    {
      "type": "image_picker",
      "id": "right_icon",
      "label": "Right Decorative Icon"
    },
    {
      "type": "header",
      "content": "Section Button (Subscription Style)"
    },
    {
      "type": "text",
      "id": "section_button_text",
      "label": "Button Text"
    },
    {
      "type": "url",
      "id": "section_button_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "desktop_margin_top",
      "label": "Desktop Margin Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "desktop_margin_bottom",
      "label": "Desktop Margin Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "mobile_margin_top",
      "label": "Mobile Margin Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "mobile_margin_bottom",
      "label": "Mobile Margin Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        {
          "type": "checkbox",
          "id": "enable_image",
          "label": "Show Image/Icon",
          "default": true
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image/Icon"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Image Link"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Feature Title"
        },
        {
          "type": "url",
          "id": "title_link",
          "label": "Title Link"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Add descriptive text about this feature or benefit.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "checkbox",
          "id": "hide_mobile",
          "label": "Hide on Mobile",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Feature Icon Columns",
      "settings": {
        "heading": "Our Features",
        "columns_desktop": "3",
        "columns_mobile": "1"
      },
      "blocks": [
        {
          "type": "column",
          "settings": {
            "title": "Quality Products",
            "text": "<p>All our products are made with the highest quality ingredients.</p>"
          }
        },
        {
          "type": "column",
          "settings": {
            "title": "Fast Shipping",
            "text": "<p>Get your orders delivered quickly with our expedited shipping options.</p>"
          }
        },
        {
          "type": "column",
          "settings": {
            "title": "Expert Support",
            "text": "<p>Our team is here to help you with any questions or concerns.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}