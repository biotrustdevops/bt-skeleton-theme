{% liquid
  assign heading_text = section.settings.heading_text | default: 'FEATURED ON'
  assign animation_speed = section.settings.animation_speed | default: 30
%}

<section class="py-8 md:py-12 overflow-hidden bg-white" data-section-id="{{ section.id }}">
  <div class="container mx-auto px-4">
    {% if heading_text != blank %}
      <h2 class="text-sm md:text-base font-semibold text-[#003d78] mb-6 md:mb-8">{{ heading_text }}</h2>
    {% endif %}
    
    <div class="md:flex md:items-center md:justify-between md:gap-8">
      <div class="flex relative md:contents">
        <div class="flex gap-12 md:contents animate-marquee md:animate-none" style="--tw-animate-duration: {{ animation_speed }}s;">
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'logo' %}
                <div class="inline-flex items-center justify-center flex-shrink-0" {{ block.shopify_attributes }}>
                  {% liquid
                    # Use default image from assets if no custom image is set
                    assign has_custom_image = false
                    if block.settings.logo_image != blank
                      assign has_custom_image = true
                      assign logo_image = block.settings.logo_image
                    elsif block.settings.default_logo != blank
                      assign default_image_path = block.settings.default_logo | append: '.png'
                      assign logo_image_url = default_image_path | asset_url
                    endif
                  %}
                  
                  {% if has_custom_image %}
                    <img 
                      src="{{ logo_image | image_url: width: 300 }}"
                      srcset="{{ logo_image | image_url: width: 150 }} 150w,
                              {{ logo_image | image_url: width: 200 }} 200w,
                              {{ logo_image | image_url: width: 300 }} 300w"
                      sizes="(max-width: 768px) 150px, 200px"
                      alt="{{ block.settings.logo_alt | default: shop.name }}"
                      width="{{ logo_image.width }}"
                      height="{{ logo_image.height }}"
                      loading="lazy"
                      class="h-10 md:h-12 w-auto object-contain"
                    >
                  {% elsif logo_image_url %}
                    <img 
                      src="{{ logo_image_url }}"
                      alt="{{ block.settings.logo_alt | default: shop.name }}"
                      width="200"
                      height="60"
                      loading="lazy"
                      class="h-10 md:h-12 w-auto object-contain"
                    >
                  {% elsif block.settings.logo_svg %}
                    <div class="h-10 md:h-12 [&_svg]:h-full [&_svg]:w-auto [&_svg]:max-w-[150px] md:[&_svg]:max-w-[200px]">
                      {{ block.settings.logo_svg }}
                    </div>
                  {% endif %}
                </div>
            {% endcase %}
          {% endfor %}
        </div>
        
        {% comment %} Duplicate set for seamless loop on mobile {% endcomment %}
        <div class="flex gap-12 absolute left-full md:hidden animate-marquee-duplicate" style="--tw-animate-duration: {{ animation_speed }}s;" aria-hidden="true">
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'logo' %}
                <div class="inline-flex items-center justify-center flex-shrink-0">
                  {% liquid
                    # Use default image from assets if no custom image is set
                    assign has_custom_image = false
                    if block.settings.logo_image != blank
                      assign has_custom_image = true
                      assign logo_image = block.settings.logo_image
                    elsif block.settings.default_logo != blank
                      assign default_image_path = block.settings.default_logo | append: '.png'
                      assign logo_image_url = default_image_path | asset_url
                    endif
                  %}
                  
                  {% if has_custom_image %}
                    <img 
                      src="{{ logo_image | image_url: width: 300 }}"
                      alt=""
                      width="{{ logo_image.width }}"
                      height="{{ logo_image.height }}"
                      loading="lazy"
                      class="h-10 w-auto object-contain"
                    >
                  {% elsif logo_image_url %}
                    <img 
                      src="{{ logo_image_url }}"
                      alt=""
                      width="200"
                      height="60"
                      loading="lazy"
                      class="h-10 w-auto object-contain"
                    >
                  {% elsif block.settings.logo_svg %}
                    <div class="h-10 [&_svg]:h-full [&_svg]:w-auto [&_svg]:max-w-[150px]">
                      {{ block.settings.logo_svg }}
                    </div>
                  {% endif %}
                </div>
            {% endcase %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Featured On",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading_text",
      "label": "Heading Text",
      "default": "FEATURED ON"
    },
    {
      "type": "range",
      "id": "animation_speed",
      "label": "Animation Speed (seconds)",
      "min": 10,
      "max": 60,
      "step": 5,
      "default": 30,
      "info": "Controls the marquee scroll speed on mobile"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "select",
          "id": "default_logo",
          "label": "Default Logo",
          "default": "",
          "options": [
            { "value": "", "label": "None" },
            { "value": "featured_on-1-Forbes", "label": "Forbes" },
            { "value": "featured_on-2-Hello", "label": "Hello" },
            { "value": "featured_on-3-Bustle", "label": "Bustle" },
            { "value": "featured_on-4-Womans_World", "label": "Woman's World" },
            { "value": "featured_on-5-GQ", "label": "GQ" },
            { "value": "featured_on-6-US_Weekly", "label": "US Weekly" },
            { "value": "featured_on-7-Elite_Daily", "label": "Elite Daily" },
            { "value": "featured_on-8-New_York_Post", "label": "New York Post" }
          ],
          "info": "Select a default logo from the theme assets"
        },
        {
          "type": "image_picker",
          "id": "logo_image",
          "label": "Custom Logo Image",
          "info": "Upload a custom logo (overrides default selection)"
        },
        {
          "type": "html",
          "id": "logo_svg",
          "label": "Logo SVG Code",
          "info": "Alternative to image. Paste SVG code directly."
        },
        {
          "type": "text",
          "id": "logo_alt",
          "label": "Alt Text",
          "info": "Describes the logo for accessibility"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured On",
      "blocks": [
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-1-Forbes",
            "logo_alt": "Forbes"
          }
        },
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-2-Hello",
            "logo_alt": "Hello"
          }
        },
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-3-Bustle",
            "logo_alt": "Bustle"
          }
        },
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-4-Womans_World",
            "logo_alt": "Woman's World"
          }
        },
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-5-GQ",
            "logo_alt": "GQ"
          }
        },
        {
          "type": "logo",
          "settings": {
            "default_logo": "featured_on-6-US_Weekly",
            "logo_alt": "US Weekly"
          }
        }
      ]
    }
  ]
}
{% endschema %}