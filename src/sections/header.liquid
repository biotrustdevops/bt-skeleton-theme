<header-dropdowns>
{% # Top Bar %}
<div class="header-top-bar bg-blue-600 text-white py-2 text-sm">
  <div class="flex items-center justify-end gap-3 md:gap-6 px-3 md:px-5 md:max-w-7xl md:mx-auto">
    <div class="relative" data-dropdown="customer-support">
      <button class="flex items-center gap-2 hover:opacity-80" data-dropdown-toggle>
        <svg class="w-5 h-5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        <span class="hidden md:inline font-medium">{{ 'header.customer_support' | t | default: 'CUSTOMER SUPPORT' }}</span>
        <svg class="hidden md:block w-3 h-3 transition-transform" data-dropdown-arrow fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
      
      {% # Customer Support Dropdown Menu %}
      <div class="absolute right-0 top-full mt-2 w-80 bg-white rounded-lg shadow-xl opacity-0 invisible transition-all duration-200 z-50" data-dropdown-menu>
        <div class="p-4">
          <h3 class="text-lg font-bold text-center text-white bg-blue-900 -m-4 mb-4 p-3 rounded-t-lg">{{ 'header.how_can_we_help' | t | default: 'HOW CAN WE HELP YOU?' }}</h3>
          
          {% # 24/7 Chat Section %}
          <div class="mb-4">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                  <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                  </svg>
                </div>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-green-500 text-sm mb-1">{{ 'header.chat_247' | t | default: '24/7 CHAT' }}</h4>
                <p class="text-gray-700 text-xs mb-3">{{ 'header.chat_description' | t | default: 'Get help now from Aidan, your BioTRUST product expert' }}</p>
                <a href="{{ section.settings.chat_link | default: '#' }}" class="inline-block bg-green-500 text-white px-4 py-2 rounded font-bold text-xs hover:bg-green-600 transition-colors">
                  {{ 'header.chat_now' | t | default: 'CHAT NOW' }}
                </a>
              </div>
            </div>
          </div>
          
          {% # Questions Section %}
          <div>
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                  ?
                </div>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-green-500 text-sm mb-1">{{ 'header.questions' | t | default: 'QUESTIONS?' }}</h4>
                <p class="text-gray-700 text-xs mb-3">{{ 'header.questions_description' | t | default: 'Get answers by visiting the customer help center' }}</p>
                <a href="{{ section.settings.help_center_link | default: '/pages/help' }}" class="inline-block bg-green-500 text-white px-4 py-2 rounded font-bold text-xs hover:bg-green-600 transition-colors">
                  {{ 'header.help_center' | t | default: 'HELP CENTER' }}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    {% if shop.customer_accounts_enabled %}
      <div class="relative" data-dropdown="my-account">
        <button class="flex items-center gap-2 hover:opacity-80" data-dropdown-toggle>
          <svg class="w-5 h-5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span class="hidden md:inline font-medium">{{ 'header.my_account' | t | default: 'MY ACCOUNT' }}</span>
          <svg class="hidden md:block w-3 h-3 transition-transform" data-dropdown-arrow fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        
        {% # My Account Dropdown Menu %}
        <div class="absolute right-0 top-full mt-2 w-56 bg-white border border-gray-200 rounded-md shadow-lg opacity-0 invisible transition-all duration-200 z-50" data-dropdown-menu>
          <div class="py-1">
            <a href="{{ routes.account_url }}/orders" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.purchase_history' | t | default: 'Purchase History' }}
            </a>
            <a href="{{ routes.account_url }}/subscriptions" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.manage_subscriptions' | t | default: 'Manage Subscriptions' }}
            </a>
            <a href="{{ routes.account_url }}/orders" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.track_my_order' | t | default: 'Track My Order' }}
            </a>
            <a href="{{ routes.account_url }}/rewards" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.biotrust_cash' | t | default: 'BioTRUST Cash' }}
            </a>
            <a href="{{ section.settings.help_center_link | default: '/pages/help' }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.customer_support_link' | t | default: 'Customer Support' }}
            </a>
            <div class="border-t border-gray-200 my-1"></div>
            <a href="{{ routes.account_logout_url }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
              {{ 'header.log_out' | t | default: 'Log Out' }}
            </a>
          </div>
        </div>
      </div>
    {% endif %}
    
    <a href="{{ routes.cart_url }}" class="flex items-center gap-2 hover:opacity-80 relative">
      <svg class="w-5 h-5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
      </svg>
      <span class="hidden md:inline font-medium">{{ 'header.my_cart' | t | default: 'MY CART' }}</span>
      {% if cart.item_count > 0 %}
        <span class="bg-white text-blue-600 px-2 py-0.5 rounded-full text-xs font-bold md:ml-1">({{ cart.item_count }})</span>
      {% else %}
        <span class="md:inline hidden">(0)</span>
      {% endif %}
    </a>
  </div>
</div>

{% # Main Header %}
<header class="bg-white shadow-sm py-3 md:py-4">
  <div class="max-w-7xl mx-auto px-3 md:px-5 flex items-center justify-between gap-4 md:gap-8">
      {% # Mobile Menu Button %}
      <button class="lg:hidden flex items-center p-2 -ml-2" data-mobile-menu-toggle>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      {% # Logo %}
      <div class="header__logo flex-shrink-0">
        {% if section.settings.logo %}
          <a href="{{ routes.root_url }}" class="block">
            {{ section.settings.logo | image_url: width: 300 | image_tag: 
              loading: 'lazy',
              widths: '100, 150, 300',
              alt: shop.name,
              class: 'h-12 md:h-14 lg:h-16 w-auto'
            }}
          </a>
        {% else %}
          <a href="{{ routes.root_url }}" class="text-2xl font-bold text-blue-600">
            {{ shop.name }}
          </a>
        {% endif %}
      </div>

      {% # Main Navigation - Hidden on Mobile %}
      <nav class="header__menu hidden lg:flex items-center gap-1 xl:gap-3 flex-shrink-0">
        {% for link in section.settings.menu.links %}
          {% if link.links != blank %}
            <div class="relative group">
              <button class="flex items-center gap-1 px-2 xl:px-4 py-2 text-gray-700 hover:text-blue-600 font-medium transition-colors whitespace-nowrap">
                {% if forloop.first %}
                  <span class="bg-blue-600 text-white px-3 xl:px-4 py-1.5 rounded uppercase text-xs xl:text-sm font-bold">{{ link.title }}</span>
                  <svg class="w-3 h-3 text-gray-400 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                {% else %}
                  <span class="uppercase text-xs xl:text-sm font-medium">{{ link.title }}</span>
                {% endif %}
              </button>
              <div class="absolute left-0 top-full mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                {% for child_link in link.links %}
                  <a href="{{ child_link.url }}" class="block px-4 py-2 text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition-colors">
                    {{ child_link.title }}
                  </a>
                {% endfor %}
              </div>
            </div>
          {% else %}
            <a href="{{ link.url }}" class="px-2 xl:px-4 py-2 text-gray-700 hover:text-blue-600 font-medium uppercase text-xs xl:text-sm transition-colors whitespace-nowrap">
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>

      {% # Search - Desktop Bar, Mobile Icon %}
      <div class="header__search flex-1 max-w-2xl hidden lg:block ml-4">
        <form action="{{ routes.search_url }}" class="relative">
          <input 
            type="search" 
            name="q" 
            placeholder="{{ 'header.search_placeholder' | t | default: 'Search all products...' }}"
            class="w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
          <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </button>
        </form>
      </div>
      
      {% # Mobile Search Icon %}
      <button class="lg:hidden p-2 -mr-2" data-search-toggle>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>
  </div>
  
  {% # Mobile Search Bar %}
  <div class="mobile-search-container hidden mt-3" data-mobile-search>
    <form action="{{ routes.search_url }}" class="relative">
      <input 
        type="search" 
        name="q" 
        placeholder="{{ 'header.search_placeholder' | t | default: 'Search all products...' }}"
        class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        data-mobile-search-input
      >
      <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>
    </form>
  </div>
</header>

{% # Mobile Menu Overlay %}
<div class="fixed inset-0 z-50 hidden" data-mobile-menu>
  {% # Backdrop %}
  <div class="fixed inset-0 bg-black bg-opacity-50" data-mobile-menu-backdrop></div>
  
  {% # Menu Panel %}
  <div class="fixed left-0 top-0 h-full w-80 max-w-full bg-white transform -translate-x-full transition-transform duration-300" data-mobile-menu-panel>
    <div class="flex items-center justify-between p-4 border-b">
      <div class="font-bold text-lg">{{ 'header.menu' | t | default: 'Menu' }}</div>
      <button class="p-2 -mr-2" data-mobile-menu-close>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <nav class="p-4">
      {% for link in section.settings.menu.links %}
        {% if link.links != blank %}
          <div class="mb-4">
            <div class="font-bold text-blue-600 mb-2">{{ link.title }}</div>
            <div class="pl-4">
              {% for child_link in link.links %}
                <a href="{{ child_link.url }}" class="block py-2 text-gray-700 hover:text-blue-600">
                  {{ child_link.title }}
                </a>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <a href="{{ link.url }}" class="block py-2 text-gray-700 hover:text-blue-600 font-medium">
            {{ link.title }}
          </a>
        {% endif %}
      {% endfor %}
    </nav>
  </div>
</div>
</header-dropdowns>

{% stylesheet %}
  /* Use Tailwind classes for most styling, keeping minimal custom CSS */
  header-dropdowns {
    display: contents; /* Make wrapper element not interfere with grid */
  }
  
  .header-top-bar {
    position: relative;
    z-index: 40;
    grid-column: 1 / -1; /* Full width spanning all columns */
  }
  
  header {
    position: relative;
    z-index: 30;
    /* Center column by default */
  }
  
  /* Dropdown menu transitions */
  .group:hover .group-hover\:opacity-100 {
    transition-delay: 0s;
  }
  
  /* Search input styling */
  .header__search input[type="search"]::-webkit-search-cancel-button {
    -webkit-appearance: none;
  }
  
  /* Dropdown active state */
  [data-dropdown].active [data-dropdown-menu] {
    opacity: 1;
    visibility: visible;
  }
  
  [data-dropdown].active [data-dropdown-arrow] {
    transform: rotate(180deg);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Logo width",
      "default": 200
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu",
      "default": "main-menu"
    },
    {
      "type": "url",
      "id": "chat_link",
      "label": "Chat Link"
    },
    {
      "type": "url",
      "id": "help_center_link",
      "label": "Help Center Link"
    }
  ]
}
{% endschema %}

{% javascript %}
  class HeaderDropdowns extends HTMLElement {
    constructor() {
      super();
      this.dropdowns = this.querySelectorAll('[data-dropdown]');
      this.mobileMenuToggle = this.querySelector('[data-mobile-menu-toggle]');
      this.mobileMenu = document.querySelector('[data-mobile-menu]');
      this.mobileMenuPanel = document.querySelector('[data-mobile-menu-panel]');
      this.mobileMenuBackdrop = document.querySelector('[data-mobile-menu-backdrop]');
      this.mobileMenuClose = document.querySelector('[data-mobile-menu-close]');
      this.searchToggle = this.querySelector('[data-search-toggle]');
      this.mobileSearchContainer = this.querySelector('[data-mobile-search]');
      this.mobileSearchInput = this.querySelector('[data-mobile-search-input]');
      this.init();
    }
    
    init() {
      // Initialize dropdowns
      this.dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('[data-dropdown-toggle]');
        const menu = dropdown.querySelector('[data-dropdown-menu]');
        
        if (!toggle || !menu) return;
        
        // Toggle dropdown on click
        toggle.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleDropdown(dropdown);
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
          if (!dropdown.contains(e.target)) {
            this.closeDropdown(dropdown);
          }
        });
        
        // Close dropdown on Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeDropdown(dropdown);
          }
        });
      });
      
      // Initialize mobile menu
      if (this.mobileMenuToggle && this.mobileMenu) {
        this.mobileMenuToggle.addEventListener('click', () => {
          this.openMobileMenu();
        });
        
        if (this.mobileMenuClose) {
          this.mobileMenuClose.addEventListener('click', () => {
            this.closeMobileMenu();
          });
        }
        
        if (this.mobileMenuBackdrop) {
          this.mobileMenuBackdrop.addEventListener('click', () => {
            this.closeMobileMenu();
          });
        }
      }
      
      // Initialize mobile search
      if (this.searchToggle && this.mobileSearchContainer) {
        this.searchToggle.addEventListener('click', () => {
          this.toggleMobileSearch();
        });
      }
    }
    
    toggleDropdown(dropdown) {
      const isActive = dropdown.classList.contains('active');
      
      // Close all other dropdowns
      this.dropdowns.forEach(d => {
        if (d !== dropdown) {
          this.closeDropdown(d);
        }
      });
      
      // Toggle current dropdown
      if (isActive) {
        this.closeDropdown(dropdown);
      } else {
        this.openDropdown(dropdown);
      }
    }
    
    openDropdown(dropdown) {
      dropdown.classList.add('active');
    }
    
    closeDropdown(dropdown) {
      dropdown.classList.remove('active');
    }
    
    openMobileMenu() {
      if (this.mobileMenu && this.mobileMenuPanel) {
        this.mobileMenu.classList.remove('hidden');
        // Force reflow for animation
        this.mobileMenuPanel.offsetHeight;
        this.mobileMenuPanel.classList.remove('-translate-x-full');
        document.body.style.overflow = 'hidden';
      }
    }
    
    closeMobileMenu() {
      if (this.mobileMenu && this.mobileMenuPanel) {
        this.mobileMenuPanel.classList.add('-translate-x-full');
        setTimeout(() => {
          this.mobileMenu.classList.add('hidden');
        }, 300);
        document.body.style.overflow = '';
      }
    }
    
    toggleMobileSearch() {
      if (this.mobileSearchContainer) {
        this.mobileSearchContainer.classList.toggle('hidden');
        if (!this.mobileSearchContainer.classList.contains('hidden') && this.mobileSearchInput) {
          this.mobileSearchInput.focus();
        }
      }
    }
  }
  
  customElements.define('header-dropdowns', HeaderDropdowns);
{% endjavascript %}
