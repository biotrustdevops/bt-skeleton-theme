{% liquid
  assign heading_text = section.settings.heading_text | default: 'Shop Healthy Aging Bestsellers'
  assign selected_collection = section.settings.collection
  if selected_collection == blank
    assign selected_collection = collections.all
  endif
  assign product_limit = section.settings.product_limit | default: 20
  assign button_text = section.settings.button_text | default: 'Shop Now'
  assign show_rating = section.settings.show_rating
%}

<section class="py-12 md:py-16 lg:py-20 bg-white" data-section-id="{{ section.id }}">
  <div class="md:container md:mx-auto px-0 md:px-4">
    {% if heading_text != blank %}
      <h2 class="text-[74px] font-normal leading-[120%] text-bt-blue text-center mb-10 md:mb-14" style="font-family: 'League Gothic', sans-serif;">{{ heading_text }}</h2>
    {% endif %}
    
    {% comment %} Swiper Container {% endcomment %}
    <div class="relative">
      <div class="swiper product-slider-{{ section.id }}">
        <div class="swiper-wrapper">
        {% for product in selected_collection.products limit: product_limit %}
            <div class="swiper-slide">
              {% render 'product-card', 
                product: product,
                button_text: button_text,
                show_rating: show_rating,
                use_yotpo: true
              %}
            </div>
        {% endfor %}
        </div>
        
        {% comment %} Pagination {% endcomment %}
        <div class="swiper-pagination !bottom-[-30px]"></div>
      </div>
      
      {% comment %} Navigation buttons positioned outside {% endcomment %}
      <button class="swiper-button-prev-{{ section.id }} absolute left-0 lg:-left-12 top-1/2 -translate-y-1/2 z-10 bg-white rounded-full shadow-lg w-10 h-10 flex items-center justify-center text-[#005eb8] hover:bg-gray-50 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button class="swiper-button-next-{{ section.id }} absolute right-0 lg:-right-12 top-1/2 -translate-y-1/2 z-10 bg-white rounded-full shadow-lg w-10 h-10 flex items-center justify-center text-[#005eb8] hover:bg-gray-50 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</section>

<style>
  /* Hide fallback stars when Yotpo loads */
  .yotpo.yotpo-stars-rating ~ .yotpo-fallback {
    display: none;
  }
  
  /* Ensure consistent card heights */
  .product-slider-{{ section.id }} .swiper-slide {
    height: auto;
  }
  
  .product-slider-{{ section.id }} .swiper-slide > div {
    height: 100%;
  }
</style>

{% comment %} Swiper CSS {% endcomment %}
{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}

{% comment %} Swiper JS {% endcomment %}
<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const swiper{{ section.id | handleize | replace: '-', '_' }} = new Swiper('.product-slider-{{ section.id }}', {
      slidesPerView: 1,
      slidesPerGroup: 1,
      spaceBetween: 20,
      navigation: {
        nextEl: '.swiper-button-next-{{ section.id }}',
        prevEl: '.swiper-button-prev-{{ section.id }}',
      },
      pagination: {
        el: '.product-slider-{{ section.id }} .swiper-pagination',
        clickable: true,
      },
      breakpoints: {
        1024: {
          slidesPerView: 5,
          slidesPerGroup: 5,
          spaceBetween: 30,
        },
      },
    });
  });
</script>

{% schema %}
{
  "name": "Product Slider",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading_text",
      "label": "Heading Text",
      "default": "Shop Healthy Aging Bestsellers"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from"
    },
    {
      "type": "range",
      "id": "product_limit",
      "label": "Maximum products to show",
      "min": 5,
      "max": 50,
      "step": 5,
      "default": 20
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop Now"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show Rating Stars",
      "default": true,
      "info": "Shows placeholder 5-star rating for all products"
    }
  ],
  "presets": [
    {
      "name": "Product Slider"
    }
  ]
}
{% endschema %}