{% stylesheet %}
  /* Star rating half-filled effect */
  .star-half {
    position: relative;
    color: #e5e7eb;
  }
  
  .star-half::before {
    content: '★';
    position: absolute;
    left: 0;
    width: 50%;
    overflow: hidden;
    color: #fbbf24;
  }

  /* Thumbnail Swiper Custom Styles */
  .thumbnail-swiper {
    width: 102px; /* Increased width to account for borders */
    padding: 0 4px; /* Add padding for border visibility */
  }
  
  .thumbnail-swiper .swiper-wrapper {
    padding: 0 2px; /* Ensure borders aren't clipped */
  }
  
  .thumbnail-swiper .swiper-slide {
    height: auto;
    display: flex;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .thumbnail-swiper .swiper-slide.loaded {
    opacity: 1;
  }

  /* Loading skeleton animation */
  .thumbnail-loading {
    width: 94px;
    height: 94px;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    border-radius: 4px;
  }

  .swiper-thumb-prev,
  .swiper-thumb-next {
    cursor: pointer;
  }

  .swiper-thumb-prev.swiper-button-disabled,
  .swiper-thumb-next.swiper-button-disabled {
    opacity: 0.35;
    cursor: not-allowed;
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Swiper for thumbnails
    const thumbSwiper = new Swiper('.thumbnail-swiper', {
      direction: 'vertical',
      slidesPerGroup: 5,
      slidesPerView: 5,
      spaceBetween: 0,
      centeredSlides: false,
      slideToClickedSlide: true,
      navigation: {
        nextEl: '.swiper-thumb-next',
        prevEl: '.swiper-thumb-prev',
      },
      watchSlidesProgress: true,
      observer: true,
      observeParents: true,
    });

    // Animate thumbnails when images load
    const thumbnailSlides = document.querySelectorAll('.thumbnail-swiper .swiper-slide');
    thumbnailSlides.forEach((slide) => {
      const img = slide.querySelector('img');
      const loadingPlaceholder = slide.querySelector('.thumbnail-loading');
      
      if (img) {
        // Hide loading placeholder and show image with animation
        const showImage = () => {
          if (loadingPlaceholder) {
            loadingPlaceholder.style.display = 'none';
          }
          slide.classList.add('loaded');
        };
        
        // Check if image is already loaded (cached)
        if (img.complete) {
          setTimeout(showImage, 50);
        } else {
          // Add loaded class when image loads
          img.addEventListener('load', showImage);
        }
      }
    });

    // Thumbnail gallery click handling
    const thumbnails = document.querySelectorAll('[data-thumbnail]');
    const mainImages = document.querySelectorAll('[data-main-image]'); // Select ALL main images
    const dots = document.querySelectorAll('[data-carousel-dot]');
    let currentImageIndex = 0;
    
    thumbnails.forEach((thumb, index) => {
      thumb.addEventListener('click', function() {
        // Remove active state from all thumbnails
        thumbnails.forEach(t => {
          t.classList.remove('border-[#0d4f9a]');
          t.classList.add('border-transparent');
        });
        // Add active state to clicked thumbnail
        this.classList.remove('border-transparent');
        this.classList.add('border-[#0d4f9a]');
        // Swap ALL main images (mobile and desktop)
        const imageUrl = this.dataset.image;
        mainImages.forEach(img => {
          if (img) {
            // Remove srcset to ensure src takes priority
            img.removeAttribute('srcset');
            img.removeAttribute('sizes');
            img.src = imageUrl;
          }
        });
        // Update mobile dots if present
        updateDots(index);
      });
    });

    // Mobile carousel dots
    function updateDots(index) {
      currentImageIndex = index;
      dots.forEach((dot, i) => {
        if (i === index) {
          dot.classList.add('bg-[#0d4f9a]');
          dot.classList.remove('bg-gray-300');
        } else {
          dot.classList.remove('bg-[#0d4f9a]');
          dot.classList.add('bg-gray-300');
        }
      });
    }

    dots.forEach((dot, index) => {
      dot.addEventListener('click', function() {
        const imageUrl = this.dataset.image;
        // Update ALL main images
        mainImages.forEach(img => {
          if (img) {
            // Remove srcset to ensure src takes priority
            img.removeAttribute('srcset');
            img.removeAttribute('sizes');
            img.src = imageUrl;
          }
        });
        updateDots(index);
        // Also update thumbnail selection
        if (thumbnails[index]) {
          thumbnails.forEach(t => {
            t.classList.remove('border-[#0d4f9a]');
            t.classList.add('border-transparent');
          });
          thumbnails[index].classList.remove('border-transparent');
          thumbnails[index].classList.add('border-[#0d4f9a]');
        }
      });
    });

    // Purchase type toggle
    const purchaseTabs = document.querySelectorAll('[data-purchase-tab]');
    purchaseTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        purchaseTabs.forEach(t => {
          t.classList.remove('bg-[#0d4f9a]', 'text-white');
          t.classList.add('bg-white', 'text-gray-700');
        });
        this.classList.remove('bg-white', 'text-gray-700');
        this.classList.add('bg-[#0d4f9a]', 'text-white');
      });
    });
  });
{% endjavascript %}

<!-- Container wrapper - max-width on desktop, full-width on mobile -->
<div class="md:container md:mx-auto md:max-w-[1440px]">

<!-- Breadcrumb -->
<div class="p-3 hidden md:block">
    <a href="{{ routes.root_url }}" class="text-lg font-medium text-bt-blue">Home</a>
</div>

<!-- Mobile: Product Images First -->
<div class="md:hidden">
    <!-- Mobile Product Title and Rating -->
    <div class="mx-2 text-center">
      {% render 'variant-servings', product: product %}
      <h1 class="text-md font-bold uppercase text-[#0d4f9a] leading-tight">{{ product.title }}</h1>
      <div class="flex flex-col items-center">
        <div class="flex">
          <span class="text-yellow-400 text-base">★</span>
          <span class="text-yellow-400 text-base">★</span>
          <span class="text-yellow-400 text-base">★</span>
          <span class="text-yellow-400 text-base">★</span>
          <span class="star-half text-base">★</span>
        </div>
        <span class="text-[#0d4f9a] text-[13px]">217 Reviews</span>
      </div>
    </div>

    <!-- Mobile Main Image -->
    <div class="w-full bg-white flex justify-center items-center">
      {% if product.featured_image %}
        {{ product.featured_image | image_url: width: 350 | image_tag: class: 'object-contain max-w-[350px] max-h-[350px]', data-main-image: true }}
      {% endif %}
    </div>
    
    <!-- Mobile Carousel Dots -->
    <div class="flex justify-center gap-2 pb-4">
      {% for image in product.images limit: 8 %}
        <button 
          data-carousel-dot
          data-image="{{ image | image_url: width: 700 }}"
          class="w-2 h-2 rounded-full {% if forloop.first %}bg-[#0d4f9a]{% else %}bg-gray-300{% endif %} cursor-pointer transition-colors"
        ></button>
      {% endfor %}
    </div>
</div>

<!-- eBook Banner (Mobile only) -->
{% if product.metafields["global"]["Free-Ebook-Image"] != blank %}
  <div class="mx-5 mb-4 md:hidden">
    <img src="{{ product.metafields["global"]["Free-Ebook-Image"] }}"
        class="free-ebook-img w-full"
        width="600"
        height="200"
        alt="Receive two free e-books with your order. 'The 3 Week Diet' and '53 Fat Burning Smoothies & Milkshakes' are yours free, a $50 value." />
  </div>
{% endif %}

<!-- Main Product Section -->
<div class="flex">

    <!-- Left Side: Thumbnails, Main Image, and eBook Banner (Desktop only) -->
    <div class="hidden md:flex md:flex-col md:w-1/2">

      <div class="flex flex-col">

        <div class="flex justify-evenly">
          <!-- Thumbnails with Swiper -->
          <div class="flex flex-col justify-center gap-2 w-[110px]">
            <!-- Up Arrow -->
            <button class="swiper-thumb-prev w-full h-8 bg-white border border-gray-300 rounded flex items-center justify-center hover:border-[#0d4f9a] hover:bg-gray-50 transition-colors cursor-pointer">
              <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
              </svg>
            </button>
            
            <!-- Swiper Container -->
            <div class="thumbnail-swiper h-[480px] overflow-hidden">
              <div class="swiper-wrapper">
                {% for image in product.images %}
                  <div class="swiper-slide">
                    <button 
                      data-thumbnail
                      data-image="{{ image | image_url: width: 700 }}"
                      class="w-[94px] h-[94px] border-2 {% if forloop.first %}border-[#0d4f9a]{% else %}border-transparent{% endif %} cursor-pointer bg-white transition-colors hover:border-gray-400 p-[7px] flex items-center justify-center relative"
                    >
                      <div class="thumbnail-loading absolute inset-[7px] animate-pulse"></div>
                      {{ image | image_url: width: 80 | image_tag: class: 'w-auto h-auto max-w-full max-h-full object-contain relative z-10', loading: 'eager' }}
                    </button>
                  </div>
                {% endfor %}
              </div>
            </div>
            
            <!-- Down Arrow -->
            <button class="swiper-thumb-next w-full h-8 bg-white border border-gray-300 rounded flex items-center justify-center hover:border-[#0d4f9a] hover:bg-gray-50 transition-colors cursor-pointer">
              <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
          </div>

          <div class="flex flex-col items-center">
            <div class="flex flex-col items-center mb-2">
              {% render 'variant-servings', product: product %}

              <!-- Title and Rating above both thumbnails and image -->
              <h1 class="text-2xl text-center font-bold uppercase text-[#0d4f9a]">
                {{ product.title }}
              </h1>

              <!-- Rating (Desktop only) -->
              <div class="flex items-center justify-center">
                <div class="flex gap-px">
                  <span class="text-yellow-400 text-base">★</span>
                  <span class="text-yellow-400 text-base">★</span>
                  <span class="text-yellow-400 text-base">★</span>
                  <span class="text-yellow-400 text-base">★</span>
                  <span class="star-half text-base">★</span>
                </div>
                <span class="text-[#0d4f9a] text-[13px] ml-0.5">217 Reviews</span>
              </div>
            </div>

            <!-- Main Image -->
            {% if product.featured_image %}
              <div>
                {{ product.featured_image | image_url: width: 550 | image_tag: class: 'object-contain max-w-[490px] max-h-[490px]', data-main-image: true }}
              </div>
            {% endif %}

            <!-- eBook Banner (Desktop) -->
            {% if product.metafields["global"]["Free-Ebook-Image"] != blank %}
              <div class="mt-4">
                <img src='{{ product.metafields["global"]["Free-Ebook-Image"] }}'
                    class="free-ebook-img w-full max-w-[490px]"
                    width="600"
                    height="200"
                    alt="Receive two free e-books with your order. 'The 3 Week Diet' and '53 Fat Burning Smoothies & Milkshakes' are yours free, a $50 value." />
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: Product Info -->
    <div class="flex-1 md:w-1/2 min-w-0">

      <!-- Package Selector -->
      <div class="md:px-6 md:py-5 p-4">
        <h2 class="text-lg md:text-[21px] font-bold text-center text-[#0d4f9a] mb-1.5">Choose Your Package</h2>
        <p class="text-center text-gray-700 text-xs md:text-sm mb-4">Select your money-saving option below:</p>
        
        <!-- Purchase Type Toggle -->
        <div class="flex gap-2 mb-4 md:mb-14">
          <button 
            data-purchase-tab
            class="flex-1 border-2 border-[#0d4f9a] bg-[#0d4f9a] text-white font-semibold text-[13px] md:text-[15px] py-2.5 px-2 md:px-4 rounded transition-colors cursor-pointer"
          >
            One-Time Purchase
          </button>
          <button 
            data-purchase-tab
            class="flex-1 border-2 border-[#0d4f9a] bg-white text-[#0d4f9a] hover:bg-gray-50 font-semibold text-[13px] md:text-[15px] py-2.5 px-2 md:px-4 rounded transition-colors cursor-pointer leading-tight"
          >
            Subscribe & Save<br class="md:hidden"><span class="md:hidden text-[11px]">Up To 50%</span><span class="hidden md:inline"> Up To 50%</span>
          </button>
        </div>

        <!-- Package Options -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-0">
          <!-- 1 Jar -->
          <div class="border-2 md:border-r-0 border-[#0d4f9a] bg-white transition-all p-3 md:px-3.5 md:py-4 md:text-center">
            <div class="flex md:block items-center gap-3">
              <!-- Mobile Product Image -->
              <div class="md:hidden w-20 h-20 flex-shrink-0">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 100 | image_tag: class: 'w-full h-full object-contain' }}
                {% endif %}
              </div>
              <div class="flex-1 md:w-full">
                <div class="text-xl md:text-[32px] font-bold text-[#0d4f9a] md:mb-1.5">1 Jar</div>
                <div class="text-2xl md:text-[38px] font-bold text-gray-800 leading-none md:my-2.5 md:mb-4">
                  <span class="text-lg md:text-[26px] align-top relative top-0.5">$</span>49
                </div>
              </div>
              <button 
                class="bg-green-600 hover:bg-green-700 text-white font-bold rounded uppercase tracking-wider transition-colors cursor-pointer py-2.5 px-6 md:px-4 text-xs md:text-sm md:w-full"
                data-open-flavor-selector
                data-quantity="1"
                data-product='{{ product | json | escape }}'
              >
                CHOOSE<br class="md:hidden"><span class="md:hidden">FLAVOR</span><span class="hidden md:inline"> FLAVOR</span>
              </button>
            </div>
          </div>

          <!-- 3 Jars (Most Popular) -->
          <div class="border-2 md:border-4 border-green-600 md:border-[#0d4f9a] bg-white transition-all md:shadow-lg p-3 md:px-4 md:py-5 md:text-center md:-my-3">
            <div class="flex md:block items-center gap-3">
              <!-- Mobile Product Image -->
              <div class="md:hidden w-20 h-20 flex-shrink-0">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 100 | image_tag: class: 'w-full h-full object-contain' }}
                {% endif %}
              </div>
              <div class="flex-1 md:w-full">
                <div class="hidden md:block bg-[#0d4f9a] text-white px-4 py-1 text-sm font-bold whitespace-nowrap mb-3 md:-mx-4 md:-mt-5">
                  Most Popular
                </div>
                <div class="text-xl md:text-[36px] font-bold text-[#0d4f9a] md:mb-2 md:mt-0">3 Jars</div>
                <div class="text-xl md:text-[42px] font-bold text-green-600 leading-none md:my-3">
                  <span class="text-base md:text-[28px] align-top relative top-0.5">$</span>44<span class="text-sm md:text-[18px] text-gray-600 ml-1 md:ml-0 md:block">Per Jar</span>
                </div>
                <div class="text-sm md:text-base text-red-600 font-semibold md:mb-4">(Save 10%)</div>
                <div class="md:hidden text-sm text-[#0d4f9a] font-semibold italic">Most Popular!</div>
              </div>
              <button 
                class="bg-green-600 hover:bg-green-700 text-white font-bold rounded uppercase tracking-wider transition-colors cursor-pointer py-2.5 px-6 md:py-3 md:px-4 text-xs md:text-[15px] md:w-full"
                data-open-flavor-selector
                data-quantity="3"
                data-product='{{ product | json | escape }}'
              >
                CHOOSE<br class="md:hidden"><span class="md:hidden">FLAVORS</span><span class="hidden md:inline"> FLAVORS</span>
              </button>
            </div>
          </div>

          <!-- 6 Jars -->
          <div class="border-2 md:border-l-0 border-[#0d4f9a] bg-white transition-all p-3 md:px-3.5 md:py-4 md:text-center">
            <div class="flex md:block items-center gap-3">
              <!-- Mobile Product Image -->
              <div class="md:hidden w-20 h-20 flex-shrink-0">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 100 | image_tag: class: 'w-full h-full object-contain' }}
                {% endif %}
              </div>
              <div class="flex-1 md:w-full">
                <div class="text-xl md:text-[32px] font-bold text-[#0d4f9a] md:mb-1.5">6 Jars</div>
                <div class="text-xl md:text-[38px] font-bold text-gray-800 leading-none md:my-2.5">
                  <span class="text-base md:text-[26px] align-top relative top-0.5">$</span>39<span class="text-sm md:text-[17px] text-gray-600 ml-1 md:ml-0 md:block">Per Jar</span>
                </div>
                <div class="text-sm md:text-[15px] text-red-600 font-semibold md:mb-3">(Save 20%)</div>
              </div>
              <button 
                class="bg-green-600 hover:bg-green-700 text-white font-bold rounded uppercase tracking-wider transition-colors cursor-pointer py-2.5 px-6 md:px-4 text-xs md:text-sm md:w-full"
                data-open-flavor-selector
                data-quantity="6"
                data-product='{{ product | json | escape }}'
              >
                CHOOSE<br class="md:hidden"><span class="md:hidden">FLAVORS</span><span class="hidden md:inline"> FLAVORS</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3 md:mt-6 overflow-hidden">
        {% render 'yotpo-product-ugc' %}
      </div>
    </div>
</div>

<!-- Product Description Section (Mobile) -->
<div class="md:hidden px-5 py-8 border-t border-gray-300">
    <h2 class="text-xl font-bold text-gray-800 mb-4">The Muscle-Support Supplement with Clinically-Backed Ingredients</h2>
    
    <p class="text-gray-700 mb-4">
      With the proven benefits of HMB, creatine, and more, Ageless Muscle provides support to:
    </p>
    
    <ul class="list-disc list-inside text-gray-700 space-y-2 mb-6">
      <li>Combat age-related muscle loss and strength loss</li>
      <li>Increase, preserve, and support healthy muscle function – even WITHOUT exercising</li>
      <li>Help maintain your independence and freedom of movement as you age</li>
      <li>Promote muscular endurance</li>
      <li>Improve athletic performance, including strength, endurance, and power</li>
      <li>Promote hydration of your body</li>
      <li>Help reduce muscle soreness and promote post-exercise recovery</li>
      <li>Get and stay lean and fit as you age to look your amazing best!</li>
    </ul>

    <p class="text-gray-700 mb-4">Ageless Muscle provides you with:</p>
    
    <ul class="list-disc list-inside text-gray-700 space-y-2">
      <li><strong>myHMB</strong>, backed by over 50 human studies. HMB helps increase muscle building while decreasing muscle breakdown.</li>
      <li><strong>Premium creatine</strong> at the optimal dose for non-bodybuilder healthy aging. Creatine helps increase muscle size and strength and overall performance.</li>
    </ul>
</div>

</div>
<!-- End container wrapper -->

<!-- Include Flavor Selector Modal -->
{% render 'flavor-selector', product: product %}

<!-- Swiper CSS and JS -->
{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}
<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}